# ======================================
# SymbioMind memory-MCP-CE Configuration
# ======================================

# ---------------------
# PostgreSQL + pgvector
# ---------------------
# These vars configure BOTH the Postgres container AND MCP-CE connection
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=memory
POSTGRES_PASSWORD=CHANGEME
POSTGRES_DB=memory

# ---------------------
# Ollama (Optional)
# ---------------------
# https://docs.ollama.com/faq#how-do-i-keep-a-model-loaded-in-memory-or-make-it-unload-immediately
OLLAMA_KEEP_ALIVE=-1 # negative number keeps the model loaded in memory
OLLAMA_MODELS=/models # internal location for models directory

# ---------------------------------------
# Embedding Model (OpenAI-compatible API)
# ---------------------------------------
# Supports: Ollama, OpenAI, LM Studio, vLLM, or any OpenAI-compatible endpoint
# Examples:
#   Ollama (local):     http://ollama:11434/v1
#   OpenAI:             https://api.openai.com/v1
#   LM Studio (local):  http://localhost:1234/v1
EMBEDDING_URL=http://ollama:11434/v1
EMBEDDING_MODEL=granite-embedding:30m # embedding_length = 384
EMBEDDING_API_KEY="" # not needed for Ollama (ignores it) - but other providers do need it

# Optional: Request specific embedding dimensions (for MRL models like Qwen)
# Matryoshka Representation Learning (MRL) models support dynamic dimensions
# If not set: auto-detects from model's native output
# If set: passes dimensions parameter to API AND validates returned dims match
# CRITICAL: Mismatch = startup failure (prevents wrong-sized vectors in memory_{dims} tables)
# Examples:
#   Qwen3 Embedding (32-4096 dims): EMBEDDING_DIMS=768
#   text-embedding-3-small (256-1536 dims): EMBEDDING_DIMS=512
#   Non-MRL models: Leave empty (EMBEDDING_DIMS=)
EMBEDDING_DIMS=


# ---------------------
# Memory Isolation
# ---------------------
# Namespace for memory isolation within the same embedding model table
# Memories are stored in dimension-specific tables (e.g., memory_384, memory_768)
# Empty namespace queries ALL namespaces in your embedding table
# Set namespace to scope to specific memories (e.g., "production", "user_123")
NAMESPACE=

# ---------------------
# Security & Encryption
# ---------------------
# Encryption for sensitive memory content (optional but recommended)
# Algorithm: AES-256-GCM (authenticated encryption)
# Key derivation: Argon2id with per-memory random salt
# Only encrypts content field - labels/embeddings/source remain plaintext for querying
# Leave empty to disable encryption (stores plain UTF-8)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
ENCRYPTION_KEY=

# Bearer Token Authentication (optional - for API-to-API auth)
# Leave empty for local/trusted use, set for public-facing deployments
# Generate with: python -c "import uuid; print(uuid.uuid7())"
BEARER_TOKEN=

# REST API Token (optional - enables /api/* endpoints)
# SEPARATE from BEARER_TOKEN above (which is for MCP endpoints)
# If not set, /api/* routes return 404 (disabled)
# If set, requires Authorization: Bearer <API_BEARER_TOKEN> header
# Used for administrative operations like re-embedding memories
# Generate with: python -c "import uuid; print(uuid.uuid7())"
API_BEARER_TOKEN=


# ---------------------
# OAuth Configuration
# ---------------------
# Single-user OAuth (optional - bundled auth provider)
OAUTH_BUNDLED=false # Set to 'true' to enable bundled single user OAuth
OAUTH_CLIENT_ID=memory-mcp-ce # OAuth client ID
OAUTH_CLIENT_SECRET=CHANGEME # OAuth client secret (generate a secure random string)
OAUTH_USERNAME=CHANGEME # Username for OAuth login
OAUTH_PASSWORD=CHANGEME # Password for OAuth login

# OAuth Token Expiry (in seconds)
OAUTH_ACCESS_TOKEN_EXPIRY=3600      # 1 hour (default)
OAUTH_REFRESH_TOKEN_EXPIRY=604800   # 7 days (default)
OAUTH_AUTH_CODE_EXPIRY=300          # 5 minutes (default)

# OAuth Redirect URIs (comma-separated, exact match required per MCP spec)
# Known AI platform redirect URIs:
# - ChatGPT: https://chatgpt.com/connector_platform_oauth_redirect
# - Claude.ai: https://claude.ai/api/mcp/auth_callback
# - Localhost (dev): http://localhost/callback,http://127.0.0.1/callback
# Example for ChatGPT only:
#   OAUTH_REDIRECT_URIS=https://chatgpt.com/connector_platform_oauth_redirect
# Example for multiple platforms:
#   OAUTH_REDIRECT_URIS=https://chatgpt.com/connector_platform_oauth_redirect,https://claude.ai/api/mcp/auth_callback
OAUTH_REDIRECT_URIS=https://claude.ai/api/mcp/auth_callback,https://chatgpt.com/connector_platform_oauth_redirect


# ---------------------
# Deployment
# ---------------------
# Public Server URL (required for OAuth and public-facing deployments)
# Used for OAuth callbacks, CORS, and generating absolute URLs
# Leave empty for local deployment (defaults to http://localhost:5005)
SERVER_URL= # e.g., "https://memory-mcp.yourdomain.com"


# ---------------------
# Timezone Configuration
# ---------------------
# Add current_time and timezone fields to all tool responses
# Helps AI assistants understand the current date/time context
# Options:
#   - Valid IANA timezone string (e.g., Australia/Adelaide, America/New_York, Europe/London)
#   - UTC (default if not set or invalid timezone)
#   - false (disables timezone feature entirely - no current_time or timezone fields in responses)
# Timezone abbreviations auto-adjust for daylight saving (e.g., ACDT/ACST for Australia/Adelaide)
TIMEZONE=UTC
